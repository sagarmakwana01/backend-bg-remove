<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Registration Page</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="/dist/css/adminlte.min.css">
</head>

<body class="hold-transition register-page">
  <div class="register-box">
  
    <span class="mail-verify" style="display:none;color:red; font-size: 12px;">please check your mailbox and verify your account.</span>
    <span class="passwordnotmatch" style="color:red;display: none;">Username or
      Password doesn't match</span>
    <span class="usernotverified" style="color:red;display: none;">No User With This
      Email</span>
    <div class="card">
      <div class="card-body register-card-body">
        <p class="login-box-msg">Sign Up</p>

        <form id="register-form">
          <span class="userrwquired" style="display:none;color:red;display: none;">Name is required</span>
          <div class="input-group mb-3">
            <input type="text" id="name" class="form-control" placeholder="Full name">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-user"></span>
              </div>
            </div>
          </div>
          <span class="email-match" style="color:red;display: none;"> Email matched</span>
          <span class="emailNotvalid" style="color:red;display: none;"> Invalid Email</span>
          <span class="emaiRequired" style="color:red;display: none;"> Email is required</span>
          <div class="input-group mb-3">
            <input type="email" id="userid" class="form-control" placeholder="Email">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-envelope"></span>
              </div>
            </div>
          </div>
          <span class="passwordlength" style="display:none;color:red;display: none;">password length must be greater than 6</span>
          <span class="passwordstring" style="display:none;color:red;display: none;">password should be Character, Symbol and numeric </span>
          <span class="passwordRequired" style="display:none;color:red;display: none;">Password is required</span>
          <div class="input-group mb-3">
            <input type="password" id="password" class="form-control" placeholder="Password">
            <div class="input-group-append">
              <div class="input-group-text pass_icon" id="toggle-password">
                <span class="fas fa-eye-slash"></span>
              </div>
            </div>
          </div>
          <span class="pass-match" style="color:red;display: none;"> Password not matched</span>
          <span class="retypePassRequired" style="color:red;display: none;"> Retype password is required</span>
          <div class="input-group mb-3">
            <input type="password" id="retypepassword" class="form-control" placeholder="Retype password">
            <div class="input-group-append">
              <div class="input-group-text pass_icon" id="toggle-retypepassword">
                <span class="fas fa-eye-slash"></span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-8">

            </div>
            <!-- /.col -->
            <div class="col-4">
              <button type="submit" class="btn btn-primary btn-block">Sign Up</button>
            </div>
            <!-- /.col -->
          </div>
        </form>

        <div class="social-auth-links ">
          <p class="text-center">-OR-</p>
          <a href="/google" class="btn btn-block btn-light">
            <img style="width: 20px; height: 20px;" src="https://img.icons8.com/color/36/000000/google-logo.png"> 
              Sign up using Google
          </a>
        </div>
        <div class="social-auth-links ">
          
   
          <a href="/microsoft" class="btn btn-block btn-light">
            <img style="width: 20px; height: 20px;" src="https://img.icons8.com/color/36/000000/microsoft.png">
            Sign up using Microsoft
          </a>
        </div>
<p>
  Already have an account? 
  <a href="/login" class="text-center">Login</a>
</p>
      </div>
      <!-- /.form-box -->
    </div><!-- /.card -->
  </div>
  <!-- /.register-box -->
<!-- Mail Verify Toast -->

  <!-- jQuery -->
  <script src="/plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- AdminLTE App -->
  <script src="/dist/js/adminlte.min.js"></script>
  <script type="text/javascript">

    const validateEmail = (email) => {
      return String(email)
        .toLowerCase()
        .match(
          /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);
    };
    let regextomatch = /^(?=(.*[a-zA-Z]){1,})(?=(.*[\d]){1,})(?=(.*[\W]){1,})(?!.*\s).{6,}$/;
    $('#register-form').on('submit', function (e) {
      e.preventDefault();

        // All fields required check
  if (!$('#name')[0].value && !$('#userid')[0].value && !$('#password')[0].value && !$('#retypepassword')[0].value) {
    // Show all-fields-required message
    $('.userrwquired').show();
    setTimeout(() => { $('.userrwquired').hide(); }, 5000)

    $('.emaiRequired').show();
    setTimeout(() => { $('.emaiRequired').hide(); }, 5000)

    $('.passwordRequired').show();
    setTimeout(() => { $('.passwordRequired').hide(); }, 5000)
    $('.retypePassRequired').show();
    setTimeout(() => { $('.retypePassRequired').hide(); }, 5000)

    return;
  }

      if(!$('#name')[0].value){
        $('.userrwquired').show();
        setTimeout(() => { $('.userrwquired').hide(); }, 5000)
        return;
      }
      if(!validateEmail($('#userid')[0].value)){
        $('.emailNotvalid').show();
        setTimeout(() => { $('.emailNotvalid').hide(); }, 5000)
        return;
      }
      if ($('#password')[0].value.length < 6) {
        $('.passwordlength').show();
        setTimeout(() => { $('.passwordlength').hide(); }, 5000)
        return;
      }
      if ($('#password')[0].value.match(regextomatch) == null) {
        $('.passwordstring').show();
        setTimeout(() => { $('.passwordstring').hide(); }, 5000)
        return;
      }


      if ($('#password')[0].value == $('#retypepassword')[0].value && validateEmail($('#userid')[0].value) && $('#name')[0].value.trim() != '') {
        let formobj = {
          name: $('#name')[0].value,
          userid: $('#userid')[0].value,
          password: $('#password')[0].value
        }
        var formBody = [];
        for (var property in formobj) {
          var encodedKey = encodeURIComponent(property);
          var encodedValue = encodeURIComponent(formobj[property]);
          formBody.push(encodedKey + "=" + encodedValue);
        }
        formBody = formBody.join("&");
        console.log(formBody)
        fetch('/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: formBody
        })
          .then((response) => {
            response.json().then((data) => {
              console.log(data.status)
              if (data.status == 'valid signup') {
                $('.mail-verify').show();
                $('#toastMailVerify').toast('show'); // Trigger toast
                $('button[type="submit"]').attr('disabled', 'disabled');
                $('button[type="submit"]').css("background", "grey");
              } else if (data.status == 'email found') {
                $('.email-match').show();
                setTimeout(() => {
                  $('.email-match').hide();
                }, 3000)
              }
            })
          })
      } else if ($('#password')[0].value !== $('#retypepassword')[0].value) {
        console.log("hello")
        $('.pass-match').show();
        setTimeout(() => {
          $('.pass-match').hide();
        }, 3000)
      }
    })
  </script>
  <script>
    document.getElementById('toggle-password').addEventListener('click', function () {
  const passwordInput = document.getElementById('password');
  const passIcon = this.querySelector('span');

  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    passIcon.classList.remove('fa-eye-slash');
    passIcon.classList.add('fa-eye');
  } else {
    passwordInput.type = 'password';
    passIcon.classList.remove('fa-eye');
    passIcon.classList.add('fa-eye-slash');
  }
});

document.getElementById('toggle-retypepassword').addEventListener('click', function () {
  const retypePasswordInput = document.getElementById('retypepassword');
  const passIcon = this.querySelector('span');

  if (retypePasswordInput.type === 'password') {
    retypePasswordInput.type = 'text';
    passIcon.classList.remove('fa-eye-slash');
    passIcon.classList.add('fa-eye');
  } else {
    retypePasswordInput.type = 'password';
    passIcon.classList.remove('fa-eye');
    passIcon.classList.add('fa-eye-slash');
  }
});

  </script>
</body>

</html>